<!doctype html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Займер — предложения</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="page">
    <header class="header">
      <div class="brand">
        <div class="brand-mark"></div>
        <div>
          <div class="brand-name">ЗАЙМЕР</div>
          <span class="brand-sub">робот онлайн займов</span>
        </div>
      </div>
      <div class="header-actions">
        <a class="link-soft" href="admin.html" aria-label="Помощь">ПОМОЩЬ</a>
        <a class="link-soft" href="#" aria-label="Выйти">ВЫЙТИ</a>
      </div>
    </header>

    <h1>Заявка на займ отклонена</h1>

    <section class="cards" id="cards-container">
      <!-- Cards will be rendered here by JavaScript -->
    </section>
  </div>

  <script src="data.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const container = document.getElementById('cards-container');
      const offers = getOffers();

      if (!offers || offers.length === 0) {
        container.innerHTML = '<p>Нет доступных предложений.</p>';
        return;
      }

      container.innerHTML = offers.map(offer => `
        <article class="card" onclick="window.location.href='${offer.link}'" style="cursor: pointer;">
          <div class="logo"><img src="${offer.logo}" alt="Company Logo"></div>
          <div class="offer">${offer.amount}<br>${offer.term}</div>
          <div class="meta">
            <span>Сумма</span>
            <span>Срок</span>
          </div>
          <p class="note">${offer.badgeText}</p>
          <button class="cta-btn" type="button">ПОЛУЧИТЬ ДЕНЬГИ</button>
          <a class="info-link" href="#" aria-label="Подробнее о компании" onclick="event.stopPropagation();">
            <span class="info-icon">i</span> подробней
          </a>
        </article>
      `).join('');

      // Function to adjust font size if text exceeds 2 lines
      function adjustFontSizes() {
        const offerElements = document.querySelectorAll('.offer');
        offerElements.forEach(el => {
          let fontSize = 17; // Start with default font size
          el.style.fontSize = fontSize + 'px';

          // Check if height exceeds 2 lines (approx 46px based on 1.35 line-height of 17px)
          // We'll use a safer check: scrollHeight > clientHeight when max-height is set, 
          // or just check height relative to line-height.
          // Since we don't have max-height set, we can check if height > line-height * 2.

          const lineHeight = parseFloat(window.getComputedStyle(el).lineHeight);
          const maxHeight = lineHeight * 2;

          while (el.offsetHeight > maxHeight + 2 && fontSize > 12) { // +2 buffer
            fontSize--;
            el.style.fontSize = fontSize + 'px';
          }
        });
      }

      // Run initially and on resize
      adjustFontSizes();
      window.addEventListener('resize', adjustFontSizes);

      // Load custom codes from localStorage
      const customCode = localStorage.getItem('zaymer_codes');
      if (customCode) {
        const div = document.createElement('div');
        div.innerHTML = customCode;

        // Execute scripts in the injected code
        Array.from(div.querySelectorAll('script')).forEach(oldScript => {
          const newScript = document.createElement('script');
          Array.from(oldScript.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value));
          newScript.appendChild(document.createTextNode(oldScript.innerHTML));
          document.body.appendChild(newScript);
        });

        // Append non-script elements
        while (div.firstChild) {
          if (div.firstChild.nodeName !== 'SCRIPT') {
            document.body.appendChild(div.firstChild);
          } else {
            div.removeChild(div.firstChild);
          }
        }
      }
    });
  </script>

</body>

</html>